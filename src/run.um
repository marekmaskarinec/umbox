
import (
        "common.um"
        "std.um"
        "../umbox/os/os.um"
        "../umbox/filepath/filepath.um"
        "../umbox/strings/strings.um"
)

fn run*(url: str, argi: int) {
        ok, meta := common.getMeta("box.json") 
        if !ok {
                printf("Not in an UmBox directory.\n")
                return
        }
        
        args := ""
        for i := argi; i < std.argc(); i++ {
                args += " " + std.argv(i)
        }
              
        cmd := meta.run
        pathSep := ""
        
        if os.getPlatform() == os.PlatformPosix {
                if len(meta.runPosix) != 0 {
                        cmd = meta.runPosix
                }
                
                pathSep = ":"
        }
             
        if os.getPlatform() == os.PlatformWindows {
                if len(meta.runWindows) != 0 {
                        cmd = meta.runWindows
                }
                
                pathSep = ";"
        }
        
        path := std.getenv("PATH")
        for i,d in meta.dependencies {
                cwd, err := os.getCwd()
                path = filepath.join(cwd, "umbox", d) + pathSep + path
        }
        os.setEnv("PATH", path)

        cmdSp := strings.split(cmd, " ")
        cmdSp[0] = filepath.fromslash(cmdSp[0])
        cmd = strings.join(cmdSp, " ")

        std.system(cmd + args)
}
